<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META http-equiv="X-UA-Compatible" content="IE=8">
<TITLE>Interaction Page</TITLE>
<!-- #include virtual="/convert-pdf-to-html/includes/pdf-to-word-head-tag.htm" -->
<META name="generator" content="BCL easyConverter SDK 5.0.08">
<script src="../js/jhtml2canvas.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="../bootstrap.min.css"/>
<script src="../js/socket.io.min.js"></script>
</HEAD>
<style>

body{
	background: #DDD;
	overflow: hidden;
}
	#page_drop{
		width: 100%;
		min-height: 100%;
	}
	#page_drop .title{
		position:relative;
		padding:10px;;
		color: #000;
		text-align:center;
	}
	#page_drop #drawingBoard{
		position: relative;
		width: 100%;
		background: #ffffff;
		border: 1px solid #AAA;
		margin:0px auto;
	}

	.warning_message{
		position: fixed;
	    width: 100%;
	    padding: 10px;
	    font-size: 20px;
	    top: 46%;
	    text-align: center
	}
	.no-padd{
		padding: 0px
	}
	.waterMarkName{
		position: absolute;
	    top: 35%;
	    left: 35%;
	    font-size: 4em;
	    opacity: 0.2;
	    color: #424040;
	}
</style>
<BODY>
<div class="container-fluid no-padd">
	<div id="page_drop" class=""></div>

</div>

<script>
(function(){
		var socket = io(),
			totalClients = 0,
		device = {
			height: window.innerHeight,
			width: document.body.clientWidth,
			halfHeight: window.innerHeight / 2,
			halfWidth: document.body.clientWidth / 2
		};

		// broadcast event
		socket.emit('device.role',{
			isAdmin: true
		});

  var interaction = new jHTML2Canvas().drawing().interact(),
		par = document.getElementById("page_drop"),
		msg = document.getElementById("message");

  		interaction.ajax.get.url = 'http://localhost/events/index.php';
  		interaction.ajax.timer = 100;
  		interaction.socketEnabled = true;
  		interaction.socket = socket;

		interaction.watch()
		.$on('stacked.clients', function(data){
			if(data){
				for(var prop in data){
					interaction.trigger(data[prop].type, data[prop].payload);
				}
			}
		})
		.$on('interaction.stack.received',function(obj){
			interaction.draw(obj);
		})
		.$on('connect.child', function(obj){
			//msg.style.display="none";
			var canRedrawClient = false
			if(obj.stack.width > device.width){
				obj.stack.width = device.width;
				canRedrawClient = true;
			}else if(device.width > obj.stack.width ){
				if(device.halfWidth <= obj.stack.width){
					obj.stack.width = device.halfWidth;
				}

				canRedrawClient = true;
			}

			if(obj.stack.height > device.halfHeight){
				obj.stack.height = device.halfHeight;
				canRedrawClient = true;
			}

			if(canRedrawClient){
				interaction.sendEvent('redraw.client', obj);
			}

			var div = document.createElement('div');
				div.setAttribute('id', obj.user);
				div.setAttribute('class','col-sm-6 no-padd');

				div.innerHTML = '<div class="childFrame"><div id="drawingBoard" style="width:'+obj.stack.width+'px; height:'+obj.stack.height+'px"><div class="waterMarkName">'+obj.stack.name+'</div></div></div>';

				par.appendChild(div);
			interaction.createChildFrame(obj, div.querySelector('#drawingBoard'));

			totalClients++;
		});

		socket.on('client.disconnected', function(data){
			interaction.destroyFrame(data.id);
			// remove the child
			var child = document.getElementById(data.id);
			if(child){
				par.removeChild(child);
			}

			totalClients--;

			if(!totalClients){
				//msg.style.display = "block";
			}
		});
})();

</script>

<!-- <script type="text/javascript" src="cordova.js"></script> -->
</BODY>
</HTML>
