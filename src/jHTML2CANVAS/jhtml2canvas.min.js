(function(){
/*@license jHTML2CANVAS
Author : Gojecks Joseph
License : GNU-2
Version 0.1.0*/
function browser(){}function getDeviceRatio(){var a=(new browser).createVirtualElement(document.body,"div",{height:"1in",left:"-100%",width:"1in"}),b=window.devicePixelRatio||1,c={dpi_x:a.offsetWidth*b,dpi_y:a.offsetHeight*b};return document.body.removeChild(a),c}function jHTML2Canvas(a){this.canvasCreated=[],this.options=defaultConfiguration,this.pages=a||{},this.browser=new browser}function getPages(a){var b,c={};return"string"==typeof a?b=document.querySelectorAll(a):"[object NodeList]"===toString.call(a)?b=a:c=a,b&&foreach(b,function(a,b){c[b]=a}),c}function jPromise(){this.queue=[],this._done=[],this._fail=[]}function getElementCss(a){var b=document.styleSheets,c={};for(var d in b){var e=b[d].rules||b[d].cssRules;for(var f in e)eleIs(a,e[f].selectorText,a.parentNode)&&(c=extend(c,css2Object(e[f].style),extractStyle(a)))}return c}function foreach(a,b){for(var c=a.length,d=0;c>d;)(b||function(){})(a[d],d),d++}function extractAttr(a,b){var c={};if("object"!=typeof b||!a)throw new error("extractAttr : requires list of attr to extract");return b.forEach(function(b){c[b]=a.getAttribute(b)}),c}function css2Object(a){var b={};if(!a)return b;if(a instanceof CSSStyleDeclaration)for(var c=a.length;c--;)b[a[c].toLowerCase()]=a[a[c]];else if("string"==typeof a){a=a.split("; ");for(var d in a){var e=a[d].split(": ");b[e[0].toLowerCase()]=e[1]}}return b}function extractStyle(a){var b={};if(a.nodeType===document.ELEMENT_NODE){var c=a.getAttribute("style");if(c){var d=c.split(";");for(var e in d){var f=d[e].split(":");b[f[0]]=f[1]}}}return b}function extend(a,b,c){if(c)return extend(extend(a,b),c);for(var d in b)a.hasOwnProperty(d)||(a[d]=b[d]);return a}function writeElementStyle(a,b){if(a&&b)for(var c in b)a.style[c]=b[c]}function isCheckAble(a){return["radio","checkbox"].indexOf(a.getAttribute("type"))>-1}function transverseDom(a,b){var c=a.ownerDocument.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),d=c.nextNode();do if(d){var e=d.tagName;switch(e.toLowerCase()){case"img":var f={height:d.clientHeight,width:d.clientWidth},g=jHTML2Canvas.prototype.generateCanvas(f),h=g.getContext("2d");h.drawImage(d,0,0),d.src=g.toDataURL();break;case"textarea":d.textContent=d.value;break;case"input":isCheckAble(d)?d.checked?d.setAttribute("checked",""):d.removeAttribute("checked"):d.setAttribute("value",d.value)}(b||function(){})(d,getElementCss(d))}while(d=c.nextNode())}function eleIs(a,b,c){var d=(c||document).querySelectorAll(b),e=!1;return foreach(d,function(b){b===a&&(e=!0)}),e}function prepareDomCloning(a){function b(){document.body.removeChild(d)}var c=a.cloneNode(!0),d=(new browser).createVirtualElement(document.body,"div");return d.appendChild(c),{content:c,destroy:b,width:c.clientWidth,height:c.clientHeight}}function pageManager(a,b){this.pages={},this.builder=new jHTML2Canvas,this.styleSheet=[];var c="A4",d=96,e={1:{top:96,left:72,right:72,bottom:10},_:{top:72,left:72,right:72,bottom:10}};this.paper=function(a){return f[a]&&(a=a),this},this.getPaperSize=function(a){var b=browser.prototype.support.deviceRatio();return f[c][b.dpi_x]?f[c][b.dpi_x]:f[c][a||d]},this.extendPaperAspect=function(a,b,c){return f[a]||(f[a]={}),f[a][b]=c,this},this.dpiFallback=function(a){return f[c][a]&&(d=a),this},this.paperMargin=function(a){return"object"==typeof a&&(e=extend({},e,a)),this},this.getPaperMargin=function(a){return a?e[a]||e._:e};var f={};f.A4={72:{width:595,height:842},96:{width:794,height:1123},150:{width:1240,height:1754},300:{width:2480,height:3508}},f.A5={72:{width:420,height:595},96:{width:595,height:794},150:{width:874,height:1240},300:{width:1748,height:2480}},f.A1={72:{width:1684,height:2384},96:{width:2245,height:3179},150:{width:3508,height:4967},300:{width:7016,height:9933}},f.A2={72:{width:1191,height:1684},96:{width:1587,height:2245},150:{width:2480,height:3508},300:{width:4960,height:7016}},f.A3={72:{width:842,height:1191},96:{width:1123,height:1587},150:{width:1754,height:2480},300:{width:3508,height:4960}},a&&this.loadTemplate(a,b)}function bindListeners(){this.afterLoadevents.forEach(function(a){var b=document.querySelectorAll("["+a+"]");if(b.length)for(var c=0;c<b.length;){var d=b[c].getAttribute(a),e=a.split("-")[2];b[c].addEventListener(e,pageManager.prototype.eventHandler(d),!1),c++}})}function templateReplacer(a,b){return a.replace(/\{\{(.*?)\}\}/g,function(a,c){return b[c]||a})}function jSVG(a,b){this.options=defaultConfiguration,this.svgData=this.getSvgContent(a),this.svg=new Blob([this.svgData],{type:"image/svg+xml;charset=utf-8"}),b&&this.createDummySvg(this.svgData),this.blobURL=this.options.domUrl.createObjectURL(this.svg),this.svgBase64Data=this.toBase64()}browser.prototype.createVirtualElement=function(a,b,c){var d=document.createElement(b);if(d.style.zIndex="-10000",d.style.position="absolute",d.style.top="-100000",d.style.visibility="hidden",c)for(var b in c)d.style[b]=c[b];return a.appendChild(d),d},browser.prototype.support={testSVG:function(){var a=new Image,b=document.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(a){return!1}return!0},testCORS:function(){return"undefined"!=typeof(new Image).crossOrigin},deviceRatio:getDeviceRatio},browser.prototype.getPageStyleSheets=function(){for(var a=document.styleSheets,b=[],c=a.length,d=0;c>d;){var e=a[d].rules;if(e.length)for(var f=0;e.length>f;)!b.indexOf(e[f].cssText)>-1&&b.push(e[f].cssText),f++;d++}return b.join("")};var defaultConfiguration={paperHeight:1319,paperWidth:1019,domUrl:window.URL||window.webkitURL||window};jHTML2Canvas.prototype.captureScreenToCanvas=function(a,b,c){var d=b.getContext("2d"),e=new jSVG(a,!0),f=b.clientHeight,g=b.clientWidth,h=this.createImage({width:g,height:f},function(){d.drawImage(this,0,0),e.close()});return function(a){h.src(e.svgBase64Data),(a||function(){})()}},jHTML2Canvas.prototype.generateCanvas=function(a){var b=document.createElement("canvas");for(var c in a)b.setAttribute(c,a[c]);return b},jHTML2Canvas.prototype.captureScreen=function(a){var b=new jSVG(a,!0),c=this.convertSVG2Canvas(b.getDummySVG(),function(){b.close(),b=null});return{appendTo:function(a){return a&&c.appendTo(a),this},getBase64:function(){return c.getBase64.apply(c.getBase64,arguments)}}},jHTML2Canvas.prototype.setPageData=function(a,b){return b&&(this.pages[a]=b),this},jHTML2Canvas.prototype.drawPagesCanvas=function(a,b,c){function d(a){return function(b){f[a]=b,i++,i===Object.keys(h).length&&g.resolve(f)}}var e=this,f={},g=new jPromise,h=getPages(this.pages),i=0;for(var j in h){var k=h[j];"[object Array]"===toString.call(k)&&(k=k.join(""));var l=e.captureScreen(k).appendTo(a);l.getBase64(b,c).done(d(j))}return g},jHTML2Canvas.prototype.drawPagesImage=function(a,b,c){var d=this,e={},f=getPages(this.pages),g=new jPromise,h=0;for(var i in f){h++;var j=f[i];"[object Array]"===toString.call(j)&&(j=j.join(""));var k=this.createImage({width:d.options.paperWidth,height:d.options.paperHeight}),l=new jSVG(j,!0);l.serializeSVG(l.getDummySVG());k.src(l.svgBase64Data),e[i]=l.toBase64(b,c),a&&a.appendChild(k.get()),l.close(),l=null,h===Object.keys(f).length&&g.resolve(e)}return g},jHTML2Canvas.prototype.createImage=function(a,b){var c=new Image;if(a)for(var d in a)c.setAttribute(d,a[d]);return this.browser.support.testCORS()&&(c.crossOrigin="Anonymous"),c.onload=b||function(){},{src:function(a){return c.src=a,this},get:function(){return c},onComplete:function(a){if(c.complete||void 0===c.complete)return(a||function(){})(c)}}},jHTML2Canvas.prototype.helpers={getElementCss:getElementCss,writeElementStyle:writeElementStyle,extend:extend,extractStyle:extractStyle,transverseDom:transverseDom,is:eleIs,promise:jPromise,forEach:foreach},jPromise.prototype={then:function(a,b){return this._done.push(a),this._fail.push(b),this},catch:function(a){return this._fail.push(a),this},done:function(a){return this._done.push(a),this},fail:function(a){return this._fail.push(a),this},resolve:function(){for(var a=this._done.length;a--;){var b=this._done.shift();b.apply(b,arguments)}},reject:function(){for(var a=this._fail.length;a--;){var b=this._fail.shift();b.apply(b,arguments)}}},jHTML2Canvas.prototype.calculatePaperSize=function(a,b){for(var c=Math.ceil(a.clientHeight/this.paperHeight),d=0;d<c;d++)this.canvasCreated.push(this.generateCanvas(idtext+"_"+d));return this},jHTML2Canvas.prototype.pageManager=pageManager,jHTML2Canvas.prototype.convertSVG2Canvas=function(a,b){if(!a)throw new error("convertSVG2Canvas : Requires SVG element.");var c=new jSVG("").serializeSVG(a),d=new jPromise,e=extractAttr(a,["width","height"]),f=this,g=f.generateCanvas(e);return this.createImage(e,function(){try{var a=g.getContext("2d");a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.drawImage(this,0,0),d.resolve(g,this)}finally{c.close(),c=null,b&&b()}}).src(c.svgBase64Data),{appendTo:function(a){return a.appendChild(g),this},getBase64:function(){var a=null,b=new jPromise,c=arguments;return d.done(function(d,e){try{a=d.toDataURL.apply(d,c)}catch(a){console.log("toDataURL: Failed to convert canvas to base64 image data")}finally{b[a?"resolve":"reject"](a)}}),b},getCanvas:function(){return g}}},pageManager.prototype.createElement=function(a,b){var c=document.createElement(a.element);if(b=b||{},a.attr)for(var d in a.attr)c.setAttribute(d,a.attr[d]);if(a.text&&(c.innerHTML=templateReplacer(a.text,b)),a.eventListener)for(var e in a.eventListener)c.setAttribute("data-event-"+e,a.eventListener[e]),this.events.afterLoadevents.push("data-event-"+e);if(a.children)for(var f in a.children)c.appendChild(pageManager.prototype.createElement(a.children[f],b));return c},pageManager.prototype.eventHandler=function(a){return this.events.handlers[a]||function(){}},pageManager.prototype.events={handlers:{},afterLoadevents:[],bindListeners:bindListeners},pageManager.prototype.loadTemplate=function(a,b){if(a){var c=new XMLHttpRequest;c.open("GET",a,!1),c.onreadystatechange=function(){if(4===c.readyState&&(200===c.status||0==c.status)){var a,d=c.responseText;try{a=JSON.parse(d)}catch(a){throw new error("Inavlid Json file received")}finally{a&&(b||function(){})(a)}}},c.send(null)}},pageManager.prototype.setPage=function(a){function b(a){function b(b){return function(d,e){return a[b]=templateReplacer(d,e),c}}var c=this;for(var d in a)this["set"+d]=b(d)}return this.pages[a]||(this.pages[a]={header:null,footer:null,body:null}),new b(this.pages[a])},pageManager.prototype.addStyle=function(a){return a&&this.styleSheet.push(a),this},pageManager.prototype.buildPages=function(a,b){function c(a,b){return"function"==typeof a?a.apply(a,[b]):a}function d(a,b,c){var d=document.createElement("style");d.textContent=a,d.setAttribute("id","jPageBuilder_"+c),d.setAttribute("type","text/css"),b.appendChild(d)}function e(b,e){var g=document.createElement("div"),h="",i=f.getPaperMargin(b);for(var j in i)g.style["padding-"+j]=i[j]+"px";g.setAttribute("id","jPageBuilder_"+b);var k=f.getPaperSize();for(var l in k)g.style[l]=k[l]+"px";var m=["header","body","footer"];for(var n in m)e[m[n]]&&(h+=c(e[m[n]],k));return h&&("string"==typeof h?g.innerHTML=h:g.appendChild(h)),function(){f.styleSheet.length&&f.styleSheet.forEach(function(a,b){d(a,g,b)}),f.builder.setPageData(b,g),a&&a.appendChild(g)}}var f=this,g=[];for(var h in this.pages)g.push(e(h,this.pages[h]));var i=0;return g.forEach(function(a){i++,a(),g.length===i&&b&&b.apply(b,[g.length])}),g=[],this},jSVG.prototype.getBlobURL=function(){return this.blobURL},jSVG.prototype.revokeBlobURL=function(){this.options.domUrl.revokeObjectURL(this.blobUrl)},jSVG.prototype.createDummySvg=function(a){if(a){var b=(new browser).createVirtualElement(document.body,"div");b.innerHTML=a,this.destroyDummySVG=function(){document.body.removeChild(b)},this.getDummySVG=function(){return b.querySelector("svg")}}return this},jSVG.prototype.serializeSVG=function(a){return this.svgData=(new XMLSerializer).serializeToString(a),this.svg=new Blob([this.svgData],{type:"image/svg+xml;charset=utf-8"}),this.blobURL=this.options.domUrl.createObjectURL(this.svg),this.svgBase64Data=this.toBase64(),this},jSVG.prototype.getSvgContent=function(a){var b=this.options.paperWidth,c=this.options.paperHeight,d=document.createElement("div");if("string"!=typeof a){var e=prepareDomCloning(a);transverseDom(e.content,function(a,b){writeElementStyle(a,b)}),a=document.body===a?e.content.innerHTML:e.content.outerHTML,e.destroy(),b=e.width,c=e.height}return d.innerHTML=a,a=(new XMLSerializer).serializeToString(d),'<svg xmlns="http://www.w3.org/2000/svg" width="'+b+'" height="'+c+'"><foreignObject width="100%" height="100%">'+a+"</foreignObject></svg>"},jSVG.prototype.toBase64=function(){var a="data:image/svg+xml;base64,";return a+=btoa(unescape(encodeURIComponent(this.svgData)))},jSVG.prototype.close=function(){this.revokeBlobURL(this.blobURL),this.destroyDummySVG&&this.destroyDummySVG(),this.svgData=null,this.svgBase64Data=null};window.jHTML2Canvas = jHTML2Canvas; })();